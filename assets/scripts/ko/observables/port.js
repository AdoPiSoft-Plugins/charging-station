define(["knockout","/public/plugins/charging-station/assets/scripts/ko/services/sessions.js","toast","http","socket","app/utils/formatDate","/public/plugins/charging-station/assets/scripts/ko/utils/format-time.js","app/utils/array.find"],function(ko,Session,toast,http,socket,formatDate,formatTime,find){return function(data){var self=this;self.id=ko.observable(data.id),self.pin=ko.observable(data.pin),self.alias=ko.observable(data.alias),self.running=ko.observable(!1),self.is_owned=ko.observable(!1),self.formatted_time=ko.observable("-");var sessions=[];http.get("/charging-plugin/port/"+data.id+"/sessions",function(running_session,data){if(running_session)return http.catchError(running_session);running_session=find(data,function(s){return"running"===s.status});if(self.running(!!running_session),running_session&&(self.is_owned(!!running_session.is_owned),sessions=data),sessions.length){for(var formatted_time="",time=0,i=0;i<sessions.length;i++){var remaining_time_seconds=sessions[i],remaining_time_seconds=remaining_time_seconds.time_seconds-remaining_time_seconds.running_time_seconds;time+=remaining_time_seconds}self.interval=setInterval(function(){var ft,t=--time;formatted_time=0<t?"<span class='calc-font'>"+(ft=formatTime(t)).hh+":"+ft.mm+":"+ft.ss+"</span>":"<span class='calc-font'>00:00:00</span>",self.formatted_time(formatted_time),t<=0&&clearInterval(self.interval)},1e3)}else self.formatted_time("<span class='calc-font'>00:00:00</span>")}),self.pauseSession=function(){http.post("/charging-plugin/port/"+data.id+"/pause",function(err,data){return err?http.catchError(err):(Session.stopSync(),Session.fetch(),void toast.error("Charging OFF"))}),self.is_owned(!1),self.running(!1),self.formatted_time("<span class='calc-font'>00:00:00</span>"),self.interval&&clearInterval(self.interval)},self.dispose=function(){self.interval&&clearInterval(self.interval)}}});