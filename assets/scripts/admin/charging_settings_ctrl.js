angular.module("Plugins").controller("ChargingStationSettingsCtrl",function($scope,ChargingStation,CatchHttpError,toastr,$ngConfirm){function loadPorts(){return ChargingStation.getPorts().then(function(res){$scope.ports=res.data||[]})}function loadRates(){return ChargingStation.getRates().then(function(res){$scope.rates=res.data||[]})}$scope.active_tab=0,$scope.new_rate={id:0,amount:0,time_minutes:0,exp_minutes:0},$scope.new_port={id:0,pin:0,alias:""},loadPorts(),loadRates(),$scope.newPort=function(){$scope.ports.push($scope.new_port)},$scope.savePort=function(id,opts,form){return(0===id?ChargingStation.createPort(opts).then(function(res){return loadPorts(),res.data}):ChargingStation.updatePort(id,opts).then(function(res){return res.data})).catch(function(e){return setTimeout(function(){form.$show()},200),CatchHttpError(e),!1})},$scope.deletePort=function(id){$ngConfirm({title:"Confirm",content:"Are you sure you want to delete this Port?",escapeKey:"close",buttons:{ok:{text:"Yes",btnClass:"btn-danger",keys:["enter"],action:function(){return ChargingStation.deletePort(id).then(loadPorts)}},close:{text:"Cancel",keys:["escape"],btnClass:"btn-default"}}})},$scope.cancelPortForm=function(id){$scope.ports=$scope.ports.filter(function(p){return 0!==p.id})},$scope.newRate=function(){$scope.rates.push($scope.new_rate)},$scope.saveRate=function(id,opts,form){return(0===id?ChargingStation.createRate(opts).then(function(res){return loadRates(),res.data}):ChargingStation.updateRate(id,opts).then(function(res){return res.data})).catch(function(e){return setTimeout(function(){form.$show()},200),CatchHttpError(e),!1})},$scope.deleteRate=function(id){$ngConfirm({title:"Confirm",content:"Are you sure you want to delete this Rate?",escapeKey:"close",buttons:{ok:{text:"Yes",btnClass:"btn-danger",keys:["enter"],action:function(){return ChargingStation.deleteRate(id).then(loadRates)}},close:{text:"Cancel",keys:["escape"],btnClass:"btn-default"}}})},$scope.cancelRateForm=function(id){$scope.rates=$scope.rates.filter(function(r){return 0!==r.id})},$scope.captive_portal={use_default_button:!0},ChargingStation.getPortalSettings().then(function(res){$scope.captive_portal=(res.data||{}).captive_portal}),$scope.updatePortalSettings=function(){return ChargingStation.updatePortalSettings($scope.captive_portal)}});