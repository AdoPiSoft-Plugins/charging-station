const router=require("./router.js"),{app}=require("plugin-core"),AppConfig=require("./app_config.js"),models=require("./models"),path=require("path"),fs=require("fs"),{promisify}=require("util"),writeFile=promisify(fs.writeFile),readFile=promisify(fs.readFile),sessions_manager=require("./services/sessions_manager.js");module.exports={async init(){await models.init(),app.use(router),await sessions_manager.init();let{hardware}=await AppConfig.readAppConfig();const rpi_boards=["rpi_3","rpi_4"],tinker_boards=["tinker"],opi_boards=AppConfig.hardwares.filter(h=>!rpi_boards.includes(h.code)&&!tinker_boards.includes(h.code)&&h.board_name).map(h=>h.code);var opi_board,script="toggle-gpio-"+(rpi_boards.includes(hardware)?"rpi.py":tinker_boards.includes(hardware)?"tinker.py":opi_boards.includes(hardware)?"opi.py":"generic.py");opi_boards.includes(hardware)&&(opi_board=AppConfig.hardwares.find(h=>h.code===hardware).board_name);const tpl=await readFile(path.join(__dirname,"scripts",script),"utf8");"production"===process.env.NODE_ENV&&await writeFile("/etc/toggle-gpio.py",tpl.replace(/BOARD_NAME/g,opi_board))},uninstall(){}};